name: build JAVA application

on:                       # Multiple triggers for this workflow
 workflow_dispatch:       # Manual trigger with user inputs
   inputs:                # Inputs visible to user when running workflow
     job_name:            # Variable name to store user selection
       description: "Select the Job to run"
       required: true
       type: choice
       options:           # User must choose one job
         - job1_build
         - job2_codeCoverage

jobs:

  job1_build:
    if: ${{ github.event.inputs.job_name == 'job1_build' }}
    # ‚úÖ This job runs only if user selects 'job1_build'

    runs-on: ubuntu-latest

    steps:
    - name: Clone the repo
      uses: actions/checkout@v6

    - name: Install java on runner
      uses: actions/setup-java@v5
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: build java code
      run: mvn clean package


  job2_codeCoverage:
    if: ${{ github.event.inputs.job_name == 'job2_codeCoverage' }}
    # ‚úÖ This job runs only if user selects 'job2_codeCoverage'
    # needs: job1_build   # (Optional) enable if you want build first, then coverage

    runs-on: ubuntu-latest

    steps:
    - name: Clone the repo
      uses: actions/checkout@v6

    - name: Install java on runner
      uses: actions/setup-java@v5
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: build java code
      run: mvn clean package

    - name: Code Coverage using sonarcloud
      run: |
        mvn -B verify sonar:sonar         -Dsonar.projectKey=sonar-demo-org-dec_sonar-demo-project-dec         -Dsonar.organization=sonar-demo-org-dec         -Dsonar.host.url=https://sonarcloud.io         -Dsonar.token=$SONAR_TOKEN

      env:
       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
       # üîë Auto-generated token by GitHub for API access

       SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
       # üîê Secret token stored in repository secrets
